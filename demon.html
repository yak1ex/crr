<html>
<head>
<link rel="stylesheet" href="crrlib.css" type="text/css" />
<!--<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.15/angular.min.js"></script>-->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/mathjs/0.22.0/math.min.js"></script>
<script src="crrlib.js"></script>
<script type="text/javascript">
// TODO: torus on/off
// TODO: adj 4/8
// TODO: colors
// TODO: size
window.onload = function() {
    var math = mathjs();
    var crr = crrlib();
    var idx1 = crr.make_helper('idx1'), adj = crr.make_helper('adj4', { torus: true });
    var table_old = [], table_new = [];
    var colors = ['#000000','#0000ff','#ff0000', '#ff00ff', '#00ff00', '#00ffff', '#ffff00', '#ffffff'];
    var counter = 0;
    crr.init('#crr-container', {
        type: 'integer',
        extent: { l: 0, b: 0, t: 100, r: 100 },
        size: { x: 100, y: 100 },
        cell: function(z) {
            return { fill: colors[table_new[idx1(z)]] }
        },
        leave: function() {
            var temp = table_old; table_old = table_new; table_new = temp;
            for(var j = 0; j < 100; ++j) {
                for(var i = 0; i < 100; ++i) {
                    var cur = idx1(i,j);
                    table_new[cur] = table_old[cur];
                    var adjs = adj(i,j);
                    for(var k = 0; k < adjs.length; ++k) {
                        var idx = adjs[k];
                        if(table_old[idx] === ((table_old[cur] + 1) %  colors.length)) {
                            table_new[cur] = table_old[idx];
                            break;
                        }
                    }
                }
            }
            $('#counter').text(++counter);
        },
        interval: 100,
    });
    for(var j = 0; j < 100; ++j) {
        for(var i = 0; i < 100; ++i) {
            table_new[idx1(i,j)] = Math.floor(Math.random() * colors.length);
        }
    }

    crr.run();

}
</script>
</head>
<body>
<div id="crr-container"></div>
<div><p id="counter"></p></div>
</body>
</html>
